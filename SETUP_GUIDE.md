# üöÄ Quick Setup Guide - JamRoom Booking Application

## Step 1: Install Dependencies

```bash
npm install
```

## Step 2: Configure MongoDB

### Option A: MongoDB Atlas (Recommended for Production)

1. Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Create a free account
3. Create a new cluster
4. Click "Connect" ‚Üí "Connect your application"
5. Copy the connection string
6. Replace `<password>` with your database password
7. Replace `<dbname>` with `jamroom`

Example:
```
mongodb+srv://myuser:mypassword@cluster0.xxxxx.mongodb.net/jamroom?retryWrites=true&w=majority
```

### Option B: Local MongoDB

```bash
# Install MongoDB locally
# Then use:
mongodb://localhost:27017/jamroom
```

## Step 3: Setup Environment Variables

### Option A: Interactive Setup (Recommended)

```bash
node createEnvFile.js
```

This interactive script will:
- Guide you through setting up all required environment variables
- Generate a secure JWT secret automatically
- Create `.env` files in both root and backend directories
- Provide helpful setup instructions and next steps

### Option B: Manual Setup

Copy the template and fill in your values:
```bash
cp .env.example .env
# Edit .env with your actual values
```

### Environment Variables Explained

```env
# üìä Database Configuration
MONGODB_URI=mongodb://localhost:27017/jamroom
# For MongoDB Atlas: mongodb+srv://user:password@cluster.mongodb.net/jamroom

# üîê Security (Auto-generated by createEnvFile.js)
JWT_SECRET=your-64-character-random-string

# üìß Email Configuration (Gmail SMTP)
EMAIL_USER=your.email@gmail.com
EMAIL_PASS=your_gmail_app_password  # Not regular password!

# üåê Server Configuration
PORT=5000
BASE_URL=http://localhost:5000
NODE_ENV=development
```

### üìß Gmail Setup Instructions

1. Enable 2-Factor Authentication on your Gmail account
2. Go to [Google App Passwords](https://support.google.com/mail/answer/185833)
3. Generate an "App Password" for "Mail"
4. Use this 16-character password (not your regular Gmail password)
5. Update `EMAIL_USER` and `EMAIL_PASS` in your `.env` file

# Server Port
PORT=5000

# UPI Payment Details (for India)
UPI_ID=yourname@paytm
UPI_NAME=JamRoom Studio
```

## Step 4: Setup Gmail for Email Notifications

1. **Go to your Google Account Settings**
   - https://myaccount.google.com/

2. **Enable 2-Factor Authentication**
   - Security ‚Üí 2-Step Verification ‚Üí Turn On

3. **Create App Password**
   - Security ‚Üí 2-Step Verification ‚Üí App passwords
   - Select "Mail" and "Other (Custom name)"
   - Enter "JamRoom" as the name
   - Click "Generate"
   - Copy the 16-character password (format: xxxx xxxx xxxx xxxx)
   - Remove spaces and use in `.env` as `EMAIL_PASS`

Example:
```env
EMAIL_USER=mystudio@gmail.com
EMAIL_PASS=abcdabcdabcdabcd
```

## Step 5: Generate JWT Secret

Use one of these methods to generate a strong secret:

### Method 1: Node.js
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

### Method 2: Online
Use any JWT secret generator or password generator (minimum 32 characters)

### Method 3: Manual
Create a long random string with letters, numbers, and special characters

Example:
```env
JWT_SECRET=8f9d7a6b5c4e3f2a1b0c9d8e7f6a5b4c3d2e1f0a9b8c7d6e5f4a3b2c1d0e9f8a7b6c5d4e3f2a1b
```

## Step 6: Start the Application

```bash
npm start
```

You should see:
```
‚úÖ MongoDB Connected
‚úÖ Admin user already exists (or created)
üöÄ Server is running on port 5000
üåê Visit: http://localhost:5000
üì± Admin Panel: http://localhost:5000/admin.html
```

## Step 7: Access the Application

1. **Home Page:** http://localhost:5000
2. **Login:** http://localhost:5000/login.html
3. **Admin Panel:** http://localhost:5000/admin.html

**Default Admin Credentials:**
- Email: `admin@jamroom.com`
- Password: `Admin@123`

## Step 8: First-Time Admin Setup

1. **Login as Admin**
   - Go to http://localhost:5000/login.html
   - Use default credentials

2. **Create Slots**
   - Go to Admin Panel ‚Üí Manage Slots tab
   - Click "Create Slots"
   - Select date range (e.g., next 30 days)
   - Set business hours (e.g., 09:00 - 22:00)
   - Set slot duration (e.g., 60 minutes)
   - Click "Create Slots"

3. **Update Settings**
   - Go to Settings tab
   - Update UPI ID and Name for payments
   - Add admin emails (comma-separated)
   - Save settings

4. **Change Default Password**
   - Logout
   - Click "Forgot Password"
   - Enter admin@jamroom.com
   - Check email for reset link
   - Set new password

## Step 9: Test User Flow

1. **Register a Test User**
   - Go to http://localhost:5000/register.html
   - Fill in details
   - Register

2. **Book a Slot**
   - Login with test user
   - Go to Booking page
   - Select date and slot
   - Choose rental type
   - Submit booking

3. **Check Email**
   - Both user and admin should receive emails

4. **Approve Booking (as Admin)**
   - Login as admin
   - Go to Bookings tab
   - Click "Approve" on the pending booking
   - Check emails for confirmation + calendar invite

## ‚úÖ Verification Checklist

- [ ] MongoDB connected successfully
- [ ] Server started without errors
- [ ] Can access home page
- [ ] Can login as admin
- [ ] Created time slots
- [ ] Registered test user
- [ ] Test user can see available slots
- [ ] Test user can create booking
- [ ] Email notifications working
- [ ] Admin can approve booking
- [ ] Calendar invite received

## ÔøΩÔ∏è Utility Scripts & Database Management

### üìã Available Utility Scripts

The project includes several utility scripts for database management and testing:

#### **Environment & Setup Scripts**

**1. Environment Setup (NEW!)**
```bash
node createEnvFile.js
```
- Interactive environment variable setup
- Generates secure JWT secrets automatically
- Creates `.env` files with proper structure
- Provides setup guidance and validation

**2. Environment Template**
```bash
node createEnvFile.js --template
```
- Creates `.env.example` template file
- Use for reference or manual setup

#### **Database Management Scripts**

**1. Clear Database (Selective)**
```bash
node clearDatabase.js
```
- Clears only booking data (bookings, slots, blockedtimes)
- Preserves users and admin settings
- Perfect for fresh start while keeping configuration

**2. Clear All Data (Complete Reset)**
```bash
node clearDatabase.js --all
```
- Wipes entire database
- Use for complete fresh installation
- Requires re-running setup scripts

**3. Check Database Status**
```bash
node checkDatabase.js
```
- Shows all collections and document counts
- Verifies database connectivity
- Useful for troubleshooting

#### **User Management Scripts**

**4. Create Test Users**
```bash
node createTestUsers.js
```
- Creates pre-configured test accounts:
  - Test User: `testuser@jamroom.com` / `TestUser@123`
  - Test Admin: `testadmin@jamroom.com` / `TestAdmin@123`
- Essential for running automated tests

**5. Create Admin Account**
```bash
node createAdmin.js
```
- Creates default admin: `admin@jamroom.com` / `Admin@123`
- Run after fresh database setup
- Interactive script with prompts

**6. Grant Admin Rights**
```bash
node makeAdmin.js
```
- Converts existing user to admin
- Interactive script - prompts for email
- Useful for promoting users

#### **System Enhancement Scripts**

**7. Update Rental System**
```bash
node updateInstrumentRentals.js
```
- Upgrades database for enhanced rental system
- Creates hierarchical categories
- Adds in-house vs per-day pricing structure
- One-time migration script

### üîÑ Recommended Script Usage Sequence

**For Fresh Setup:**
```bash
# 0. Setup environment variables first!
node createEnvFile.js

# 1. Clear everything
node clearDatabase.js --all

# 2. Start server (creates default settings)
npm start
# Stop server (Ctrl+C)

# 3. Create admin account
node createAdmin.js

# 4. Create test users (for testing)
node createTestUsers.js

# 5. Update to enhanced rental system
node updateInstrumentRentals.js

# 6. Check everything is setup correctly
node checkDatabase.js
```

**For Testing/Development:**
```bash
# Clear booking data only (keeps config)
node clearDatabase.js

# Verify clean state
node checkDatabase.js

# Run tests
# Visit /test.html or /test-rental-system.html
```

**For Production Maintenance:**
```bash
# Check database health
node checkDatabase.js

# Clear old bookings if needed
node clearDatabase.js

# Grant admin to new user
node makeAdmin.js
```

## üß™ Testing Tools

1. **Comprehensive API Tests**: Visit `/test.html`
2. **Enhanced Rental System Tests**: Visit `/test-rental-system.html`
3. **Test Accounts**: Created automatically with `createTestUsers.js`

## ÔøΩüêõ Common Issues

### Issue: MongoDB Connection Failed

**Solution:**
- Check MONGO_URI in `.env`
- Verify MongoDB Atlas IP whitelist (add 0.0.0.0/0 for testing)
- Check username and password
- Ensure database name is included in URI

### Issue: Email Not Sending

**Solution:**
- Verify Gmail App Password (not regular password)
- Check EMAIL_USER and EMAIL_PASS in `.env`
- Test with a simple email first
- Check spam folder

### Issue: Cannot Login

**Solution:**
- Use exact credentials: admin@jamroom.com / Admin@123
- Check console for errors
- Clear browser localStorage
- Restart server

### Issue: Port Already in Use

**Solution:**
```bash
# Windows
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# Change port in .env
PORT=3000
```

## üìû Need Help?

- Check the main README.md for detailed documentation
- Review server logs in terminal
- Check browser console for frontend errors
- Verify all environment variables are set

## üéâ Success!

If everything works, you should be able to:
1. ‚úÖ Book slots as a user
2. ‚úÖ Approve bookings as admin
3. ‚úÖ Receive email notifications
4. ‚úÖ See UPI payment details
5. ‚úÖ Download calendar invites

---

**Next Steps:**
- Deploy to production (Vercel/Render)
- Customize rental types and pricing
- Add more admin users
- Customize email templates
- Set up custom domain
